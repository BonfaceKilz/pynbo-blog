<!doctype html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="#PyNBO, The Python-Nairobi Blog">


        <title>Python parametrized unit testing with Pytest // #PyNBO // The Python-Nairobi Blog</title>


    <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/pure/0.3.0/pure-min.css">
    <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/font-awesome/4.1.0/css/font-awesome.min.css">
    <link rel="stylesheet" href="./theme/css/pure.css">

    <link rel="stylesheet" href="./theme/css/pygments.css">

    <script src="//cdnjs.cloudflare.com/ajax/libs/jquery/2.0.3/jquery.min.js"></script>
    <script src="//cdnjs.cloudflare.com/ajax/libs/fitvids/1.0.1/jquery.fitvids.min.js"></script>
    <script>
        $(document).ready(function(){
            $(".content").fitVids();
        });
    </script>
    <link href="./theme/css/cuprum_bolditalic/cuprum.css" rel="stylesheet">
    <link href="./theme/css/pynbo.css" rel="stylesheet">
</head>

<body>
<div class="pure-g-r" id="layout">
    <div class="sidebar sidebar-article pure-u">
        <header class="header-article">
            <hgroup>
                <a href="./author/paul-upendo.html" title="See posts by Paul Upendo">
                    <img class="avatar" alt="Paul Upendo" src="http://www.gravatar.com/avatar/284e23ffa81864a09d1fe7597d44ffab">
                    <h2 class="article-info">Paul Upendo</h2>
                </a>
                <small class="about-author">Upendo is a Software Developer at Andela Kenya</small>
                <h5>Published</h5>
                <p>September 04, 2017</p>
                <a href="/">&larr;Home</a>
            </hgroup>
        </header>
    </div>
    <div class="pure-u">
        <div class="content">
            <section class="post">
                <header class="post-header">
                    <h1>Python parametrized unit testing with Pytest</h1>
                        <p class="post-meta">
                            // under                                 <a class="post-category" href="./tag/python.html">python</a>
                                <a class="post-category" href="./tag/pytest.html">pytest</a>
                        </p>
                </header>
            </section>
            <h2>Pre-requisites</h2>
<blockquote>
<ul>
<li>Beginner level Python</li>
<li>Python2<em> or Python3</em> installed</li>
<li>Basic knowledge on TDD and python UnitTesting</li>
<li>Pytest installed</li>
</ul>
</blockquote>
<h1>Intro</h1>
<p>I really did not get a hang of TDD the first time I heard about it. I saw it as an acronym that was maybe too difficult to fathom. A few months down the line I have a clear and better perspective towards it, and even better a more pythonic way to use TDD in my software development. Hang on as we methodically dive into it.</p>
<p>TDD (Test Driven Development) is a software design methodology. This generally means writing UnitTests for your code even before you write it yourself. TDD, now that you are farmiliar with the acronym, is not limited to a particular language stack but for this instance we will stick to python as our language of choice. </p>
<h1>Parametrizing your tests with Pytest</h1>
<p>There are a couple of UnitTesting frameworks in python:
- Python Unittest (that comes with the standard python library distribution)
- Python Pytest 
- Python-nose</p>
<p>Python UnitTest framework is a member of the XUnit family of testing tools that use a similar pattern for defining testCases. With UnitTest following XUnit Conventions, it makes Pytest and Python-nose a more - Pythonic way to write tests that follow Pep8 style guide. I will focus on paramet`rization of tests using Pytest. </p>
<h4>Why parametrize my tests?</h4>
<p>Let's think of a scenario where we have to write tests for a particular function but with multiple input values/arguments. Rewriting my assertion statements with the different arguments works quite well but what if we could simplify this to only one assertion statement for that function? Then run the test multiple times with an array of parameters? Smart right? Python's Pytest provides an excellent Pythonic way to achieve this.</p>
<p><code>@pytest.mark.parametrize</code> allows one to define multiple sets of arguments and fixtures at the test function or class.</p>
<p>Let us write parametrized tests for a function that accepts integer input from the user and determines whether the input is odd or even.</p>
<div class="highlight"><pre><span></span><span class="c1"># File test_parametrization.py</span>
<span class="kn">import</span> <span class="nn">pytest</span>


<span class="nd">@pytest.mark.parametrize</span><span class="p">(</span><span class="s2">&quot;test_input,expected&quot;</span><span class="p">,</span> <span class="p">[</span>
    <span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="s2">&quot;odd&quot;</span><span class="p">),</span>
    <span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="s2">&quot;even&quot;</span><span class="p">),</span>
    <span class="p">(</span><span class="mi">9</span><span class="p">,</span> <span class="s2">&quot;even&quot;</span><span class="p">),</span>
<span class="p">])</span>

<span class="k">def</span> <span class="nf">test_even_and_odd_numbers</span><span class="p">(</span><span class="n">test_input</span><span class="p">,</span> <span class="n">expected</span><span class="p">):</span>
    <span class="k">assert</span> <span class="p">(</span><span class="n">runOddEvenCheck</span><span class="p">(</span><span class="n">test_input</span><span class="p">))</span> <span class="o">==</span> <span class="n">expected</span>
</pre></div>


<p>To run this, use the command <code>pytest</code>, which executes the pytest test runner for us. The result for this would be a series of failing tests as we can see below. The beautiful thing about this is that by implementing test parameterization, Pytest created 3 individual tests for us from our test function :smile: .</p>
<div class="highlight"><pre><span></span><span class="c1"># Commandline output</span>
<span class="p">(</span><span class="n">pytest_blog</span><span class="p">)</span> <span class="o">~/</span><span class="n">D</span><span class="o">/</span><span class="n">t</span><span class="o">/</span><span class="n">p</span><span class="o">/</span><span class="n">parameterized_testing</span> <span class="err">❯❯❯</span> <span class="n">pytest</span>                                                                                                                                                                                                                       <span class="err">⏎</span> <span class="n">develop</span> <span class="err">✱</span> <span class="err">◼</span>
<span class="o">===================================================================================================================================</span> <span class="n">test</span> <span class="n">session</span> <span class="n">starts</span> <span class="o">===================================================================================================================================</span>
<span class="n">platform</span> <span class="n">darwin</span> <span class="o">--</span> <span class="n">Python</span> <span class="mf">3.6</span><span class="o">.</span><span class="mi">1</span><span class="p">,</span> <span class="n">pytest</span><span class="o">-</span><span class="mf">3.2</span><span class="o">.</span><span class="mi">1</span><span class="p">,</span> <span class="n">py</span><span class="o">-</span><span class="mf">1.4</span><span class="o">.</span><span class="mi">34</span><span class="p">,</span> <span class="n">pluggy</span><span class="o">-</span><span class="mf">0.4</span><span class="o">.</span><span class="mi">0</span>
<span class="n">rootdir</span><span class="p">:</span> <span class="o">/</span><span class="n">Users</span><span class="o">/</span><span class="n">Upendo</span><span class="o">/</span><span class="n">Documents</span><span class="o">/</span><span class="n">tech_blogs</span><span class="o">/</span><span class="n">pytest_blog</span><span class="o">/</span><span class="n">parameterized_testing</span><span class="p">,</span> <span class="n">inifile</span><span class="p">:</span>
<span class="n">collected</span> <span class="mi">3</span> <span class="n">items</span>

<span class="n">test_parametrization</span><span class="o">.</span><span class="n">py</span> <span class="n">FFF</span>

<span class="o">========================================================================================================================================</span> <span class="n">FAILURES</span> <span class="o">=========================================================================================================================================</span>
<span class="n">____________________________________________________________________________________________________________________________</span> <span class="n">test_even_and_odd_numbers</span><span class="p">[</span><span class="mi">3</span><span class="o">-</span><span class="n">odd</span><span class="p">]</span> <span class="n">_____________________________________________________________________________________________________________________________</span>

<span class="n">test_input</span> <span class="o">=</span> <span class="mi">3</span><span class="p">,</span> <span class="n">expected</span> <span class="o">=</span> <span class="s1">&#39;odd&#39;</span>

    <span class="nd">@pytest.mark.parametrize</span><span class="p">(</span><span class="s2">&quot;test_input,expected&quot;</span><span class="p">,</span> <span class="p">[</span>
        <span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="s2">&quot;odd&quot;</span><span class="p">),</span>
        <span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="s2">&quot;even&quot;</span><span class="p">),</span>
        <span class="p">(</span><span class="mi">9</span><span class="p">,</span> <span class="s2">&quot;even&quot;</span><span class="p">),</span>
    <span class="p">])</span>

    <span class="k">def</span> <span class="nf">test_even_and_odd_numbers</span><span class="p">(</span><span class="n">test_input</span><span class="p">,</span> <span class="n">expected</span><span class="p">):</span>
<span class="o">&gt;</span>       <span class="k">assert</span> <span class="p">(</span><span class="n">runOddEvenCheck</span><span class="p">(</span><span class="n">test_input</span><span class="p">))</span> <span class="o">==</span> <span class="n">expected</span>
<span class="n">E</span>       <span class="ne">NameError</span><span class="p">:</span> <span class="n">name</span> <span class="s1">&#39;runOddEvenCheck&#39;</span> <span class="ow">is</span> <span class="ow">not</span> <span class="n">defined</span>

<span class="n">test_parametrization</span><span class="o">.</span><span class="n">py</span><span class="p">:</span><span class="mi">11</span><span class="p">:</span> <span class="ne">NameError</span>
<span class="n">____________________________________________________________________________________________________________________________</span> <span class="n">test_even_and_odd_numbers</span><span class="p">[</span><span class="mi">4</span><span class="o">-</span><span class="n">even</span><span class="p">]</span> <span class="n">____________________________________________________________________________________________________________________________</span>

<span class="n">test_input</span> <span class="o">=</span> <span class="mi">4</span><span class="p">,</span> <span class="n">expected</span> <span class="o">=</span> <span class="s1">&#39;even&#39;</span>

    <span class="nd">@pytest.mark.parametrize</span><span class="p">(</span><span class="s2">&quot;test_input,expected&quot;</span><span class="p">,</span> <span class="p">[</span>
        <span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="s2">&quot;odd&quot;</span><span class="p">),</span>
        <span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="s2">&quot;even&quot;</span><span class="p">),</span>
        <span class="p">(</span><span class="mi">9</span><span class="p">,</span> <span class="s2">&quot;even&quot;</span><span class="p">),</span>
    <span class="p">])</span>

    <span class="k">def</span> <span class="nf">test_even_and_odd_numbers</span><span class="p">(</span><span class="n">test_input</span><span class="p">,</span> <span class="n">expected</span><span class="p">):</span>
<span class="o">&gt;</span>       <span class="k">assert</span> <span class="p">(</span><span class="n">runOddEvenCheck</span><span class="p">(</span><span class="n">test_input</span><span class="p">))</span> <span class="o">==</span> <span class="n">expected</span>
<span class="n">E</span>       <span class="ne">NameError</span><span class="p">:</span> <span class="n">name</span> <span class="s1">&#39;runOddEvenCheck&#39;</span> <span class="ow">is</span> <span class="ow">not</span> <span class="n">defined</span>

<span class="n">test_parametrization</span><span class="o">.</span><span class="n">py</span><span class="p">:</span><span class="mi">11</span><span class="p">:</span> <span class="ne">NameError</span>
<span class="n">____________________________________________________________________________________________________________________________</span> <span class="n">test_even_and_odd_numbers</span><span class="p">[</span><span class="mi">9</span><span class="o">-</span><span class="n">even</span><span class="p">]</span> <span class="n">____________________________________________________________________________________________________________________________</span>

<span class="n">test_input</span> <span class="o">=</span> <span class="mi">9</span><span class="p">,</span> <span class="n">expected</span> <span class="o">=</span> <span class="s1">&#39;even&#39;</span>

    <span class="nd">@pytest.mark.parametrize</span><span class="p">(</span><span class="s2">&quot;test_input,expected&quot;</span><span class="p">,</span> <span class="p">[</span>
        <span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="s2">&quot;odd&quot;</span><span class="p">),</span>
        <span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="s2">&quot;even&quot;</span><span class="p">),</span>
        <span class="p">(</span><span class="mi">9</span><span class="p">,</span> <span class="s2">&quot;even&quot;</span><span class="p">),</span>
    <span class="p">])</span>

    <span class="k">def</span> <span class="nf">test_even_and_odd_numbers</span><span class="p">(</span><span class="n">test_input</span><span class="p">,</span> <span class="n">expected</span><span class="p">):</span>
<span class="o">&gt;</span>       <span class="k">assert</span> <span class="p">(</span><span class="n">runOddEvenCheck</span><span class="p">(</span><span class="n">test_input</span><span class="p">))</span> <span class="o">==</span> <span class="n">expected</span>
<span class="n">E</span>       <span class="ne">NameError</span><span class="p">:</span> <span class="n">name</span> <span class="s1">&#39;runOddEvenCheck&#39;</span> <span class="ow">is</span> <span class="ow">not</span> <span class="n">defined</span>

<span class="n">test_parametrization</span><span class="o">.</span><span class="n">py</span><span class="p">:</span><span class="mi">11</span><span class="p">:</span> <span class="ne">NameError</span>
<span class="o">================================================================================================================================</span> <span class="mi">3</span> <span class="n">failed</span> <span class="ow">in</span> <span class="mf">0.07</span> <span class="n">seconds</span> <span class="o">=================================================================================================================================</span>
<span class="p">(</span><span class="n">pytest_blog</span><span class="p">)</span> <span class="o">~/</span><span class="n">D</span><span class="o">/</span><span class="n">t</span><span class="o">/</span><span class="n">p</span><span class="o">/</span><span class="n">parameterized_testing</span> <span class="err">❯❯❯</span>           
</pre></div>


<p>This just made the process to write our tests less time consuming, not that this will always be the case as it also depends on the complexity or requirements of the project/code  we plan to write after the tests for. 
Let us get back to fixing our failing tests as per the output we have received form Pytest test runner :bowtie:
All our asserts fail as a NameError exception is raised. So let's fix that by creating a function <code>runOddEvenCheck</code> to check for number state whether odd or even when user input is provided. Then import the function for our tests to use.</p>
<div class="highlight"><pre><span></span><span class="c1"># File numberWork.py</span>
<span class="k">def</span> <span class="nf">runOddEvenCheck</span><span class="p">(</span><span class="n">nums</span><span class="p">):</span>
    <span class="k">return</span> <span class="s2">&quot;even&quot;</span> <span class="k">if</span> <span class="n">nums</span> <span class="o">%</span> <span class="mi">2</span> <span class="o">==</span> <span class="mi">0</span> <span class="k">else</span> <span class="s2">&quot;odd&quot;</span>
</pre></div>


<p>Then let us import this function to our test file:</p>
<div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">pytest</span>
<span class="kn">from</span> <span class="nn">numberWork</span> <span class="kn">import</span> <span class="n">runOddEvenCheck</span>


<span class="nd">@pytest.mark.parametrize</span><span class="p">(</span><span class="s2">&quot;test_input,expected&quot;</span><span class="p">,</span> <span class="p">[</span>
    <span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="s2">&quot;odd&quot;</span><span class="p">),</span>
    <span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="s2">&quot;even&quot;</span><span class="p">),</span>
    <span class="p">(</span><span class="mi">9</span><span class="p">,</span> <span class="s2">&quot;even&quot;</span><span class="p">),</span>
<span class="p">])</span>
<span class="k">def</span> <span class="nf">test_even_and_odd_numbers</span><span class="p">(</span><span class="n">test_input</span><span class="p">,</span> <span class="n">expected</span><span class="p">):</span>
    <span class="k">assert</span> <span class="p">(</span><span class="n">runOddEvenCheck</span><span class="p">(</span><span class="n">test_input</span><span class="p">))</span> <span class="o">==</span> <span class="n">expected</span>
</pre></div>


<p>And we can finally run our tests with <code>pytest</code>:</p>
<div class="highlight"><pre><span></span><span class="p">(</span><span class="n">pytest_blog</span><span class="p">)</span> <span class="o">~/</span><span class="n">D</span><span class="o">/</span><span class="n">t</span><span class="o">/</span><span class="n">p</span><span class="o">/</span><span class="n">parameterized_testing</span> <span class="err">❯❯❯</span> <span class="n">pytest</span>                                                                                                                                                                                                                       <span class="err">⏎</span> <span class="n">develop</span> <span class="err">✱</span> <span class="err">◼</span>
<span class="o">===================================================================================================================================</span> <span class="n">test</span> <span class="n">session</span> <span class="n">starts</span> <span class="o">===================================================================================================================================</span>
<span class="n">platform</span> <span class="n">darwin</span> <span class="o">--</span> <span class="n">Python</span> <span class="mf">3.6</span><span class="o">.</span><span class="mi">1</span><span class="p">,</span> <span class="n">pytest</span><span class="o">-</span><span class="mf">3.2</span><span class="o">.</span><span class="mi">1</span><span class="p">,</span> <span class="n">py</span><span class="o">-</span><span class="mf">1.4</span><span class="o">.</span><span class="mi">34</span><span class="p">,</span> <span class="n">pluggy</span><span class="o">-</span><span class="mf">0.4</span><span class="o">.</span><span class="mi">0</span>
<span class="n">rootdir</span><span class="p">:</span> <span class="o">/</span><span class="n">Users</span><span class="o">/</span><span class="n">Upendo</span><span class="o">/</span><span class="n">Documents</span><span class="o">/</span><span class="n">tech_blogs</span><span class="o">/</span><span class="n">pytest_blog</span><span class="o">/</span><span class="n">parameterized_testing</span><span class="p">,</span> <span class="n">inifile</span><span class="p">:</span>
<span class="n">collected</span> <span class="mi">3</span> <span class="n">items</span>

<span class="n">test_parametrization</span><span class="o">.</span><span class="n">py</span> <span class="o">..</span><span class="n">F</span>

<span class="o">========================================================================================================================================</span> <span class="n">FAILURES</span> <span class="o">=========================================================================================================================================</span>
<span class="n">____________________________________________________________________________________________________________________________</span> <span class="n">test_even_and_odd_numbers</span><span class="p">[</span><span class="mi">9</span><span class="o">-</span><span class="n">even</span><span class="p">]</span> <span class="n">____________________________________________________________________________________________________________________________</span>

<span class="n">test_input</span> <span class="o">=</span> <span class="mi">9</span><span class="p">,</span> <span class="n">expected</span> <span class="o">=</span> <span class="s1">&#39;even&#39;</span>

    <span class="nd">@pytest.mark.parametrize</span><span class="p">(</span><span class="s2">&quot;test_input,expected&quot;</span><span class="p">,</span> <span class="p">[</span>
        <span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="s2">&quot;odd&quot;</span><span class="p">),</span>
        <span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="s2">&quot;even&quot;</span><span class="p">),</span>
        <span class="p">(</span><span class="mi">9</span><span class="p">,</span> <span class="s2">&quot;even&quot;</span><span class="p">),</span>
    <span class="p">])</span>
    <span class="k">def</span> <span class="nf">test_even_and_odd_numbers</span><span class="p">(</span><span class="n">test_input</span><span class="p">,</span> <span class="n">expected</span><span class="p">):</span>
<span class="o">&gt;</span>       <span class="k">assert</span> <span class="p">(</span><span class="n">runOddEvenCheck</span><span class="p">(</span><span class="n">test_input</span><span class="p">))</span> <span class="o">==</span> <span class="n">expected</span>
<span class="n">E</span>       <span class="ne">AssertionError</span><span class="p">:</span> <span class="k">assert</span> <span class="s1">&#39;odd&#39;</span> <span class="o">==</span> <span class="s1">&#39;even&#39;</span>
<span class="n">E</span>         <span class="o">-</span> <span class="n">odd</span>
<span class="n">E</span>         <span class="o">+</span> <span class="n">even</span>

<span class="n">test_parametrization</span><span class="o">.</span><span class="n">py</span><span class="p">:</span><span class="mi">11</span><span class="p">:</span> <span class="ne">AssertionError</span>
<span class="o">===========================================================================================================================</span> <span class="mi">1</span> <span class="n">failed</span><span class="p">,</span> <span class="mi">2</span> <span class="n">passed</span> <span class="ow">in</span> <span class="mf">0.06</span> <span class="n">seconds</span> <span class="o">============================================================================================================================</span>
<span class="p">(</span><span class="n">pytest_blog</span><span class="p">)</span> <span class="o">~/</span><span class="n">D</span><span class="o">/</span><span class="n">t</span><span class="o">/</span><span class="n">p</span><span class="o">/</span><span class="n">parameterized_testing</span> <span class="err">❯❯❯</span> 
</pre></div>


<p>Wow, we do have passing and failing tests now from our Pytest report. Two tests pass, with one failing test (Fact being that 9 is not an even number from the AssertionError message above).
From these example we are now able to give parametrized testing a try I hope :smile:. The topic is quite vast, this is just but a sneak peak at the good we can do with the Pythonic Pytest.
If you would like to try this example out, <a href="https://github.com/paulupendo/parametrized_testing/tree/master">here is a link to the source code on github</a>. <code>Fork</code>, <code>Clone</code>, <code>install requirements</code> and <code>pytest</code> :smile:. </p>
<p>Happy coding!</p>
            <div class="hr"></div>
            <a href="#" class="go-top">Go Top</a>
<footer class="footer">
    <p>&copy; #PyNBO &ndash;
        Built with
        ( <a href="https://github.com/Python-Nairobi/pure-pynbo"> a slightly modified</a> )
        <a href="https://github.com/PurePelicanTheme/pure">Pure Theme</a>
        for <a href="http://blog.getpelican.com/">Pelican</a>
    </p>
</footer>        </div>
    </div>
</div>
    <script>
        var $top = $('.go-top');

        // Show or hide the sticky footer button
        $(window).scroll(function() {
            if ($(this).scrollTop() > 200) {
                $top.fadeIn(200);
            } else {
                $top.fadeOut(200);
            }
        });

        // Animate the scroll to top
        $top.click(function(event) {
            event.preventDefault();
            $('html, body').animate({scrollTop: 0}, 300);
        })

        // Makes sure that the href="#" attached to the <a> elements
        // don't scroll you back up the page.
        $('body').on('click', 'a[href="#"]', function(event) {
            event.preventDefault();
        });
    </script>
    <script>
        (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
        (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
        m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
        })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

        ga('create', 'UA-54801851-1', 'auto');
        ga('require', 'displayfeatures');
        ga('send', 'pageview');
    </script>
</body>
</html>